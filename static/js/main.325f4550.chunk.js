(this["webpackJsonplarvaio-cloud-device-react-demo"]=this["webpackJsonplarvaio-cloud-device-react-demo"]||[]).push([[6],{35:function(e,t,n){var r={"./lar-analog-value.entry.js":[42,25],"./lar-app.entry.js":[43,26],"./lar-area-troubles.entry.js":[44,0,1,4,3,16],"./lar-area.entry.js":[45,0,1,3,14],"./lar-backdrop_14.entry.js":[46,0,1,4,3,12],"./lar-button-push.entry.js":[47,27],"./lar-debug.entry.js":[48,28],"./lar-door.entry.js":[49,29],"./lar-inner-range-area.entry.js":[50,30],"./lar-inner-range-door.entry.js":[51,31],"./lar-onoff.entry.js":[52,32],"./lar-push-button.entry.js":[53,33],"./lar-radio-button.entry.js":[54,15],"./lar-range.entry.js":[55,34],"./lar-rtsp-h264-mjpeg.entry.js":[126,11],"./lar-slider.entry.js":[56,22],"./lar-sliding-door.entry.js":[57,0,13],"./lar-toggle.entry.js":[58,19],"./lar-two-pos-controller.entry.js":[59,17],"./lar-utility-log.entry.js":[60,0,1,23],"./lar-utility-meter.entry.js":[61,0,1,4,18]};function a(e){if(!n.o(r,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],a=t[0];return Promise.all(t.slice(1).map(n.e)).then((function(){return n(a)}))}a.keys=function(){return Object.keys(r)},a.id=35,e.exports=a},37:function(e,t,n){var r={"./24h non-burgular.svg":62,"./airflow.svg":63,"./alarm.svg":64,"./back.svg":65,"./barrier.svg":66,"./carbonmonoxide.svg":67,"./chart-bar.svg":68,"./chart-bar2.svg":69,"./check.svg":70,"./cloud.svg":71,"./combustion.svg":72,"./device.svg":73,"./door.svg":74,"./dot-circle.svg":75,"./down.svg":76,"./electricity.svg":77,"./fail to report in.svg":78,"./fire.svg":79,"./fire_alarm.svg":80,"./flame.svg":81,"./foil.svg":82,"./gas.svg":83,"./glass.svg":84,"./halflock.svg":85,"./halflock_trouble.svg":86,"./hight temp.svg":87,"./info.svg":88,"./intruder_alarm.svg":89,"./loading.svg":90,"./lock.svg":91,"./lock2.svg":92,"./lock_trouble.svg":93,"./log.svg":94,"./low temp.svg":95,"./medical.svg":96,"./medical_alarm.svg":97,"./movement.svg":98,"./moving-cogs.svg":99,"./off.svg":100,"./on.svg":101,"./other_alarm.svg":102,"./panic.svg":103,"./panic_alarm.svg":104,"./perimeter.svg":105,"./personal emergency.svg":106,"./refrigeration.svg":107,"./security.svg":108,"./security2.svg":109,"./services.svg":110,"./sliding-door.svg":111,"./smoke.svg":112,"./solid-circle.svg":113,"./sound.svg":114,"./tank level.svg":115,"./temperature.svg":116,"./unlock.svg":117,"./unlock2.svg":118,"./user.svg":119,"./users.svg":120,"./vibration.svg":121,"./warning.svg":122,"./water.svg":123,"./water2.svg":124,"./window.svg":125};function a(e){return s(e).then(n)}function s(e){return n.e(9).then((function(){if(!n.o(r,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return r[e]}))}a.keys=function(){return Object.keys(r)},a.resolve=s,a.id=37,e.exports=a},38:function(e,t,n){},40:function(e,t,n){"use strict";n.r(t);var r=n(6),a=n.n(r),s=n(24),o=n.n(s),i=n(15),c=n(0),u=n.n(c),l=n(2),d=n(4),v=n(5),g=n(3),p=n(7),h=n(8),b=(n(38),n(20)),j=n(1),f=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).state={loading:!1,username:"",password:""},r.device=r.props.device,r.handleUsernameChange=r.handleUsernameChange.bind(Object(g.a)(r)),r.handlePasswordChange=r.handlePasswordChange.bind(Object(g.a)(r)),r.handleSubmit=r.handleSubmit.bind(Object(g.a)(r)),r}return Object(v.a)(n,[{key:"handleUsernameChange",value:function(e){this.setState({username:e.target.value})}},{key:"handlePasswordChange",value:function(e){this.setState({password:e.target.value})}},{key:"handleSubmit",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),this.setState({loading:!0}),e.prev=2,e.next=5,this.device.request("iot-2/cmd/login/fmt/json",{username:this.state.username,password:this.state.password});case 5:if((n=e.sent).access_token){e.next=8;break}throw new Error("Invalid login response");case 8:this.props.onLoginDone(n.access_token),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),alert("Login Error: ".concat(e.t0.message));case 14:return e.prev=14,this.setState({loading:!1}),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[2,11,14,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state.loading?Object(j.jsx)("div",{children:"Loading..."}):Object(j.jsx)("span",{});return Object(j.jsxs)("div",{children:[e,Object(j.jsxs)("form",{onSubmit:this.handleSubmit,children:["Username:",Object(j.jsx)("input",{type:"text",value:this.state.username,onChange:this.handleUsernameChange}),Object(j.jsx)("br",{}),"Paassword:",Object(j.jsx)("input",{type:"password",value:this.state.password,onChange:this.handlePasswordChange}),Object(j.jsx)("br",{}),Object(j.jsx)("button",{disabled:this.state.loading,type:"submit",children:"Login"})]})]})}}]),n}(r.Component),m=n(25),y=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).state={loading:!0,closed:!1,nodes:[]},r.device=r.props.device,r.deviceClosed=r.deviceClosed.bind(Object(g.a)(r)),r.createReactComponent=r.createReactComponent.bind(Object(g.a)(r)),r.device.addEventListener("broadcast",n.handleBroadcast),r.device.addEventListener("close",r.deviceClosed),r}return Object(v.a)(n,[{key:"componentDidMount",value:function(){var e=Object(l.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.device.open();case 3:return e.next=5,this.device.getUINodes();case 5:t=e.sent,this.setState({nodes:t,closed:!1,loading:!1}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),alert("Failed to connect to device: ".concat(e.t0.message));case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.device.removeEventListener("broadcast",n.handleBroadcast),this.device.removeEventListener("close",this.deviceClosed);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deviceClosed",value:function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({loading:!1,closed:!0,nodes:[]});case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createReactComponent",value:function(e){if(!e||!e.ui||!e.node||!e.component)throw new Error("Invalid node object");return a.a.createElement(e.component,{color:"primary",colorInputs:"primary",colorModal:"primary",mainTitle:e.ui.name,supTitle:e.ui.room?e.ui.room.name:"",subTitle:e.ui.category?e.ui.category.name:"",icon:e.ui.icon,nodeId:e.node.id,key:e.node.id,log:e.ui.log,onOutput:this.device.handleNodeOutput,onRequest:this.device.handleNodeRequest})}},{key:"render",value:function(){var e=this.state,t=e.loading,r=e.nodes,a=e.closed,s=t?Object(j.jsx)("div",{children:"Loading..."}):Object(j.jsx)("span",{}),o=a?Object(j.jsx)("div",{children:"Device connection closed"}):Object(j.jsx)("span",{}),c=r.filter((function(e){return!!e.ui.visible})).sort((function(e,t){return parseInt(t.ui.rating,10)-parseInt(e.ui.rating,10)})).map((function(e){var t=n.pascalize(e.node.type);return"undefined"===typeof i[t]?(console.error("Cannot find Larva.io WebComonent for ".concat(t)),e):Object(m.a)(Object(m.a)({},e),{},{component:i[t]})})).filter((function(e){return!!e.component})),u=c.filter((function(e){return!e.ui.favorite})).map(this.createReactComponent),l=c.filter((function(e){return!!e.ui.favorite})).map(this.createReactComponent);return Object(j.jsxs)("div",{children:[s,o,Object(j.jsxs)(i.LarApp,{children:[Object(j.jsx)("div",{className:"favorites-grid",children:l}),Object(j.jsx)("div",{className:"grid",children:u})]})]})}}],[{key:"pascalize",value:function(e){var t=e.replace(/-./g,(function(e){return e.toUpperCase()[1]}));return t.charAt(0).toUpperCase()+t.slice(1)}},{key:"handleBroadcast",value:function(){var e=Object(l.a)(u.a.mark((function e(t){var n,r,a,s;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t&&t.detail?t.detail:{},r=n.evt,a=n.payload||{},r){e.next=5;break}return e.abrupt("return");case 5:(s=document.querySelector("*[node-id='".concat(r,"']")))&&s.input(a.data);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),n}(r.Component),k=function(e){Object(p.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(d.a)(this,n),(r=t.call(this,e)).token="",r.state={loggedIn:!1,opened:!1},r.logout=r.logout.bind(Object(g.a)(r)),r.setToken=r.setToken.bind(Object(g.a)(r)),r.setToken=r.setToken.bind(Object(g.a)(r)),r.getToken=r.getToken.bind(Object(g.a)(r)),r.device=new b.a("76696365-733a-5465-7374-446576696365","00000000-0000-0000-0000-000000000000",r.getToken,{server:"wss://broker.larva.io",timeout:8e3}),r}return Object(v.a)(n,[{key:"componentDidMount",value:function(){var e=Object(l.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.device.open().catch((function(e){return alert(e.message)}));case 2:this.setToken(),this.setState({opened:!0});case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getToken",value:function(){return this.token}},{key:"setToken",value:function(e){this.token=e,this.setState({loggedIn:!!this.token})}},{key:"logout",value:function(){this.setToken("")}},{key:"render",value:function(){var e=this.state.loggedIn?Object(j.jsxs)("div",{children:[Object(j.jsx)("button",{type:"button",onClick:this.logout,children:"Logout"}),Object(j.jsx)(y,{device:this.device})]}):Object(j.jsx)(f,{device:this.device,onLoginDone:this.setToken});return Object(j.jsxs)("div",{className:"App",children:[!this.state.opened&&Object(j.jsx)("span",{children:"Opening connection to broker...."}),this.state.opened&&e]})}}]),n}(r.Component);Object(i.setupConfig)({videoproxyURL:"wss://video-broker.larva.io/"}),o.a.render(Object(j.jsx)(a.a.StrictMode,{children:Object(j.jsx)(k,{})}),document.getElementById("app"))}},[[40,8,10]]]);
//# sourceMappingURL=main.325f4550.chunk.js.map