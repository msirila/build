(this["webpackJsonplarvaio-cloud-device-react-demo"]=this["webpackJsonplarvaio-cloud-device-react-demo"]||[]).push([[22],{136:function(t,e,r){"use strict";r.r(e),r.d(e,"lar_cognito_login",(function(){return l}));var n=r(0),a=r.n(n),i=r(1),s=r(6),o=r(7),c=r(25),u=r(187),h=r(188),l=function(){function t(e){Object(s.a)(this,t),Object(c.h)(this,e),this.loginDone=Object(c.d)(this,"loginDone",7),this.loginError=Object(c.d)(this,"loginError",7),this.loading=Object(c.d)(this,"loading",7),this.back=Object(c.d)(this,"back",7),this.loginText="Login",this.verifyText="Verify",this.backText="Back",this.forgetPasswordText="Forgot password",this.continueText="Continue",this.changeText="Change",this.haveCodeText="I already have a code",this.sendCodeText="Send code",this.twoStepVerificationText="Please enter code you received via sms or generated by mobile application",this.passwsordChangeRequiredText="Password change required",this.newPasswordText="New Password",this.confirmPasswordText="Confirm Password",this.passwordText="Password",this.usernameText="Username",this.verificationText="Your account needs to be verified",this.codeText="Code",this.enterCoreText="Please enter code and new password. Code sent to:",this.submitButtonColor="primary",this.backButtonColor="dark",this.showForgotPasswordLink=!0,this.showBack=!1,this.disableUsername=!1,this.cognitoUsernameAttribute="any",this.state=h.a.USER_LOGIN,this.loadingState=!1,this.verifyMethod="email",this.usernameInternal="",this.mfaCode="",this.verifyCode="",this.passwordFirst="",this.passwordSecond="",this.password=""}return Object(o.a)(t,[{key:"updateUsername",value:function(t){t&&(this.usernameInternal=t)}},{key:"componentWillLoad",value:function(){var t=Object(i.a)(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.username&&(this.usernameInternal=this.username);case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"isLoading",value:function(){var t=Object(i.a)(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",this.loadingState);case 1:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"setLoading",value:function(t){this.loadingState=t,this.loading.emit(t)}},{key:"login",value:function(){var t=Object(i.a)(a.a.mark((function t(){var e,r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.setLoading(!0),this.usernameInternal&&this.password){t.next=5;break}return this.loginError.emit("Incorrect username or password."),t.abrupt("return");case 5:return t.next=7,u.a.signIn(this.usernameInternal,this.password);case 7:if(this.user=t.sent,"SMS_MFA"!==(e=this.user.challengeName)&&"SOFTWARE_TOKEN_MFA"!==e){t.next=13;break}this.state=h.a.MFA,t.next=19;break;case 13:if("NEW_PASSWORD_REQUIRED"!==e){t.next=17;break}this.state=h.a.NEW_PASSWORD,t.next=19;break;case 17:return t.next=19,this.checkUser();case 19:t.next=43;break;case 21:if(t.prev=21,t.t0=t.catch(0),console.error(t.t0),"PasswordResetRequiredException"!==t.t0.code){t.next=42;break}return t.prev=25,this.loginError.emit("Account password reset requred"),t.next=29,u.a.forgotPassword(this.usernameInternal);case 29:if(!(r=t.sent)||!r.CodeDeliveryDetails){t.next=35;break}return this.state=h.a.PASSWORD_RECOVERY_PASSWORD,t.abrupt("return");case 35:throw new Error("Failed to start password recovery");case 36:t.next=41;break;case 38:t.prev=38,t.t1=t.catch(25),this.loginError.emit(t.t1.message);case 41:return t.abrupt("return");case 42:this.loginError.emit(t.t0.message);case 43:return t.prev=43,this.setLoading(!1),t.finish(43);case 46:case"end":return t.stop()}}),t,this,[[0,21,43,46],[25,38]])})));return function(){return t.apply(this,arguments)}}()},{key:"sendVerificationCode",value:function(){var t=Object(i.a)(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.setLoading(!0),t.next=4,u.a.verifyCurrentUserAttribute(this.verifyMethod);case 4:this.state=h.a.VERIFICATION_CODE,t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),this.loginError.emit(t.t0.message);case 10:return t.prev=10,this.setLoading(!1),t.finish(10);case 13:case"end":return t.stop()}}),t,this,[[0,7,10,13]])})));return function(){return t.apply(this,arguments)}}()},{key:"tryVerificationCode",value:function(){var t=Object(i.a)(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.setLoading(!0),t.next=4,u.a.verifyCurrentUserAttributeSubmit(this.verifyMethod,this.verifyCode);case 4:return t.next=6,this.checkUser();case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),this.loginError.emit(t.t0.message);case 11:return t.prev=11,this.setLoading(!1),t.finish(11);case 14:case"end":return t.stop()}}),t,this,[[0,8,11,14]])})));return function(){return t.apply(this,arguments)}}()},{key:"mfaVerification",value:function(){var t=Object(i.a)(a.a.mark((function t(){return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.setLoading(!0),t.next=4,u.a.confirmSignIn(this.user,this.mfaCode);case 4:return t.next=6,this.checkUser();case 6:t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),this.loginError.emit(t.t0.message);case 11:return t.prev=11,this.setLoading(!1),t.finish(11);case 14:case"end":return t.stop()}}),t,this,[[0,8,11,14]])})));return function(){return t.apply(this,arguments)}}()},{key:"changePassword",value:function(){var t=Object(i.a)(a.a.mark((function t(){var e,r;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.setLoading(!0),this.passwordFirst===this.passwordSecond){t.next=4;break}throw new Error("Passwords don't match");case 4:if(this.user){t.next=10;break}return t.next=7,u.a.currentAuthenticatedUser();case 7:if(this.user=t.sent,this.user){t.next=10;break}throw new Error("Not logged in");case 10:return t.next=12,u.a.completeNewPassword(this.user,this.passwordFirst,null===(r=null===(e=this.user)||void 0===e?void 0:e.challengeParam)||void 0===r?void 0:r.requiredAttributes);case 12:return t.next=14,u.a.signOut();case 14:return this.password=this.passwordFirst,t.next=17,this.login();case 17:t.next=22;break;case 19:t.prev=19,t.t0=t.catch(0),this.loginError.emit(t.t0.message);case 22:return t.prev=22,this.setLoading(!1),t.finish(22);case 25:case"end":return t.stop()}}),t,this,[[0,19,22,25]])})));return function(){return t.apply(this,arguments)}}()},{key:"checkUser",value:function(){var t=Object(i.a)(a.a.mark((function t(){var e;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,this.user){t.next=7;break}return t.next=4,u.a.currentAuthenticatedUser();case 4:if(this.user=t.sent,this.user){t.next=7;break}throw new Error("Not logged in");case 7:return t.next=9,u.a.verifiedContact(this.user);case 9:(e=t.sent)&&0===Object.keys(e.unverified).length?this.loginDone.emit(this.usernameInternal):(this.unverifiedItems=e.unverified,this.state=h.a.VERIFICATION),t.next=16;break;case 13:t.prev=13,t.t0=t.catch(0),this.loginError.emit(t.t0.message);case 16:case"end":return t.stop()}}),t,this,[[0,13]])})));return function(){return t.apply(this,arguments)}}()},{key:"changeState",value:function(t){this.state=t}},{key:"renderVerifyRadios",value:function(){var t=this;if(this.unverifiedItems)return Object.keys(this.unverifiedItems).map((function(e){return Object(c.f)("lar-cognito-radio",{key:e,label:t.unverifiedItems[e],value:e,checked:t.verifyMethod===e,onChange:function(e){e.target.checked&&(t.verifyMethod=e.target.value)}})}))}},{key:"renderState",value:function(){var t=this;switch(this.state){case h.a.USER_LOGIN:return Object(c.f)("form",{onSubmit:function(){var e=Object(i.a)(a.a.mark((function e(r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),e.next=3,t.login();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},Object(c.f)("lar-cognito-username-input",{label:this.usernameText,type:this.cognitoUsernameAttribute,value:this.usernameInternal,disabled:this.disableUsername,onUsernameInput:function(e){t.usernameInternal=e.target.value}}),Object(c.f)("lar-cognito-input",{label:this.passwordText,type:"password",autocomplete:"password",value:this.password,onInput:function(e){return t.password=e.target.value}}),this.showBack?Object(c.f)("lar-cognito-button",{type:"button",color:this.backButtonColor,onClick:function(){return t.back.emit()},disabled:this.loadingState},this.backText):void 0,Object(c.f)("lar-cognito-button",{type:"submit",color:this.submitButtonColor,disabled:this.loadingState||!this.usernameInternal||!this.password},this.loginText),this.showForgotPasswordLink?Object(c.f)("a",{href:"#",onClick:function(e){e.preventDefault(),t.changeState(h.a.PASSWORD_RECOVERY_PASSWORD)}},this.forgetPasswordText):void 0);case h.a.PASSWORD_RECOVERY_PASSWORD:return Object(c.f)("lar-cognito-password-recovery",{onRecoveryError:function(e){return t.loginError.emit(e.detail)},onRecoveryDone:function(e){return t.loginDone.emit(e.detail)},showBack:!0,backText:this.backText,username:this.usernameInternal,changeText:this.changeText,continueText:this.continueText,newPasswordText:this.newPasswordText,confirmPasswordText:this.confirmPasswordText,passwordText:this.passwordText,usernameText:this.usernameText,enterCoreText:this.enterCoreText,codeText:this.codeText,onBack:function(e){e.stopPropagation(),t.changeState(h.a.USER_LOGIN)},submitButtonColor:this.submitButtonColor,backButtonColor:this.backButtonColor,cognitoUsernameAttribute:this.cognitoUsernameAttribute,disableUsername:this.disableUsername});case h.a.MFA:return Object(c.f)("form",{onSubmit:function(){var e=Object(i.a)(a.a.mark((function e(r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),e.next=3,t.mfaVerification();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},Object(c.f)("p",null,this.twoStepVerificationText),Object(c.f)("lar-cognito-input",{type:"text",value:this.mfaCode,onChange:function(e){return t.mfaCode=e.target.value}}),Object(c.f)("lar-cognito-button",{type:"button",color:this.backButtonColor,onClick:function(){return t.changeState(h.a.USER_LOGIN)},disabled:this.loadingState},this.backText),Object(c.f)("lar-cognito-button",{type:"submit",color:this.submitButtonColor,disabled:this.loadingState||!this.mfaCode},this.verifyText));case h.a.NEW_PASSWORD:return Object(c.f)("form",{onSubmit:function(){var e=Object(i.a)(a.a.mark((function e(r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),e.next=3,t.changePassword();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},Object(c.f)("p",null,this.passwsordChangeRequiredText),Object(c.f)("lar-cognito-input",{label:this.newPasswordText,type:"password",autocomplete:"password",value:this.passwordFirst,onChange:function(e){return t.passwordFirst=e.target.value}}),Object(c.f)("lar-cognito-input",{label:this.confirmPasswordText,type:"password",autocomplete:"password",value:this.passwordSecond,onChange:function(e){return t.passwordSecond=e.target.value}}),Object(c.f)("lar-cognito-button",{type:"button",color:this.backButtonColor,onClick:function(){return t.changeState(h.a.USER_LOGIN)},disabled:this.loadingState},this.backText),Object(c.f)("lar-cognito-button",{type:"submit",color:this.submitButtonColor,disabled:this.loadingState||!this.passwordFirst||!this.passwordSecond},this.changeText));case h.a.VERIFICATION:return Object(c.f)("form",{onSubmit:function(){var e=Object(i.a)(a.a.mark((function e(r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),e.next=3,t.sendVerificationCode();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},Object(c.f)("p",null,this.verificationText),this.renderVerifyRadios(),Object(c.f)("lar-cognito-button",{type:"button",color:this.backButtonColor,onClick:function(){return t.changeState(h.a.USER_LOGIN)},disabled:this.loadingState},this.backText),Object(c.f)("lar-cognito-button",{type:"submit",color:this.submitButtonColor,disabled:this.loadingState},this.sendCodeText),Object(c.f)("lar-cognito-button",{type:"button",color:this.submitButtonColor,onClick:function(){return t.changeState(h.a.VERIFICATION_CODE)},disabled:this.loadingState},this.haveCodeText));case h.a.VERIFICATION_CODE:return Object(c.f)("form",{onSubmit:function(){var e=Object(i.a)(a.a.mark((function e(r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),e.next=3,t.tryVerificationCode();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},Object(c.f)("p",null,this.verificationText),Object(c.f)("lar-cognito-input",{label:this.codeText,type:"text",value:this.verifyCode,onChange:function(e){return t.verifyCode=e.target.value}}),Object(c.f)("lar-cognito-button",{type:"button",color:this.backButtonColor,onClick:function(){return t.changeState(h.a.USER_LOGIN)}},this.backText),Object(c.f)("lar-cognito-button",{type:"submit",color:this.submitButtonColor,disabled:this.loadingState||!this.verifyCode},this.verifyText));default:return Object(c.f)("div",null,"No state")}}},{key:"render",value:function(){return Object(c.f)("div",null,this.renderState())}}],[{key:"watchers",get:function(){return{username:["updateUsername"]}}}]),t}();l.style=".sc-lar-cognito-login-h{display:block;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-color:transparent;color:var(--lar-text-color, #fff);font-family:var(--lar-font-family, inherit);display:block;position:relative !important;margin:0 !important;padding:0 !important;-webkit-overflow-scrolling:touch;will-change:scroll-position;-ms-scroll-chaining:none;overscroll-behavior:contain;overflow:auto}lar-cognito-button.sc-lar-cognito-login:first-of-type{display:block;margin-top:1rem}p.sc-lar-cognito-login{text-align:center}"},188:function(t,e,r){"use strict";var n;r.d(e,"a",(function(){return n})),function(t){t[t.PASSWORD_RECOVERY_USERNAME=0]="PASSWORD_RECOVERY_USERNAME",t[t.PASSWORD_RECOVERY_PASSWORD=1]="PASSWORD_RECOVERY_PASSWORD",t[t.USER_LOGIN=2]="USER_LOGIN",t[t.NEW_PASSWORD=3]="NEW_PASSWORD",t[t.MFA=4]="MFA",t[t.VERIFICATION=5]="VERIFICATION",t[t.VERIFICATION_CODE=6]="VERIFICATION_CODE"}(n||(n={}))}}]);
//# sourceMappingURL=22.33c105e0.chunk.js.map